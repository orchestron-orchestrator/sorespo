import file
import process

import orchestron.build
import orchestron.yang as oyang
import tmf.yang
from transform_list_order import remove_list_user_order
from transform_filter_schema import filter_schema

actor main(env):
    fc = file.FileCap(env.cap)
    pc = process.ProcessCap(env.cap)

    orchestron.build.apply_schema_transforms_to_dir(fc, "yang/CiscoIosXr_24_1_ncs55a1", [
        orchestron.build.SchemaTransformChain(".*yang.orig", [orchestron.build.SchemaTransformNoComments()])
    ])
    orchestron.build.apply_schema_transforms_to_dir(fc, "yang/NokiaSRLinux_25_3_2", [
        orchestron.build.SchemaTransformChain(".*yang.orig", [orchestron.build.SchemaTransformNoComments()])
    ])

    cfs_layer = orchestron.build.Layer.from_dir(fc, "yang/cfs")
    cfs_layer.models.extend([
        oyang.ietf_inet_types,
        tmf.yang.otmf.replace("TMF640_STORE_TRANSFORM", "sorespo.tmf.Tmf640Store"),
        tmf.yang.otmf640
    ])
    inter_layer = orchestron.build.Layer.from_dir(fc, "yang/inter")
    inter_layer.models.append(oyang.ietf_inet_types)
    rfs_layer = orchestron.build.Layer.from_dir(fc, "yang/rfs")
    rfs_layer.models.extend([oyang.rfs, oyang.ietf_inet_types])

    def transform_list_order(dt):
        paths = [
            "/jc:configuration/protocols/bgp/group/neighbor",
            "/jc:configuration/protocols/mpls/interface",
        ]
        remove_list_user_order(dt.root, paths)
        return dt

    def transform_filter(dt):
        # The original list of paths was auto-generated by comparing the old
        # (augmented junos-conf-root) with new (single junos-conf-root) model
        # and printing the common paths. The list here is a result of manual
        # pruning to include (approximately) what we actually use in rfs.act.
        # Optimized compile time from 50s to 5s.
        paths = [
    "/jc:configuration/interfaces/interface/description",
    "/jc:configuration/interfaces/interface/mac",
    "/jc:configuration/interfaces/interface/mtu",
    "/jc:configuration/interfaces/interface/name",
    "/jc:configuration/interfaces/interface/native-vlan-id",
    "/jc:configuration/interfaces/interface/unit/alias",
    "/jc:configuration/interfaces/interface/unit/description",
    "/jc:configuration/interfaces/interface/unit/encapsulation",
    "/jc:configuration/interfaces/interface/unit/family/inet",
    "/jc:configuration/interfaces/interface/unit/family/inet/address/name",
    "/jc:configuration/interfaces/interface/unit/family/inet6",
    "/jc:configuration/interfaces/interface/unit/family/inet6/address/name",
    "/jc:configuration/interfaces/interface/unit/family/iso",
    "/jc:configuration/interfaces/interface/unit/family/iso/address/name",
    "/jc:configuration/interfaces/interface/unit/mac",
    "/jc:configuration/interfaces/interface/unit/mtu",
    "/jc:configuration/interfaces/interface/unit/name",
    "/jc:configuration/interfaces/interface/unit/vlan-id",
    "/jc:configuration/protocols/bgp/group/authentication-algorithm",
    "/jc:configuration/protocols/bgp/group/authentication-key",
    "/jc:configuration/protocols/bgp/group/authentication-key-chain",
    "/jc:configuration/protocols/bgp/group/description",
    "/jc:configuration/protocols/bgp/group/export",
    "/jc:configuration/protocols/bgp/group/family/evpn/signaling",
    "/jc:configuration/protocols/bgp/group/family/inet-vpn/unicast",
    "/jc:configuration/protocols/bgp/group/family/inet6-vpn/unicast",
    "/jc:configuration/protocols/bgp/group/family/route-target",
    "/jc:configuration/protocols/bgp/group/hold-time",
    "/jc:configuration/protocols/bgp/group/local-address",
    "/jc:configuration/protocols/bgp/group/name",
    "/jc:configuration/protocols/bgp/group/neighbor/description",
    "/jc:configuration/protocols/bgp/group/neighbor/name",
    "/jc:configuration/protocols/bgp/group/neighbor/passive",
    "/jc:configuration/protocols/bgp/group/tcp-mss",
    "/jc:configuration/protocols/bgp/group/tcpao-auth-mismatch",
    "/jc:configuration/protocols/bgp/group/type",
    "/jc:configuration/protocols/bgp/log-updown",
    "/jc:configuration/protocols/isis/interface/family/name",
    "/jc:configuration/protocols/isis/interface/ldp-synchronization",
    "/jc:configuration/protocols/isis/interface/ldp-synchronization/disable",
    "/jc:configuration/protocols/isis/interface/ldp-synchronization/hold-time",
    "/jc:configuration/protocols/isis/interface/level/disable",
    "/jc:configuration/protocols/isis/interface/level/metric",
    "/jc:configuration/protocols/isis/interface/level/name",
    "/jc:configuration/protocols/isis/interface/lsp-interval",
    "/jc:configuration/protocols/isis/interface/name",
    "/jc:configuration/protocols/isis/interface/passive",
    "/jc:configuration/protocols/isis/interface/passive/remote-node-id",
    "/jc:configuration/protocols/isis/interface/passive/remote-node-iso",
    "/jc:configuration/protocols/isis/interface/point-to-point",
    "/jc:configuration/protocols/isis/level/authentication-key",
    "/jc:configuration/protocols/isis/level/authentication-type",
    "/jc:configuration/protocols/isis/level/disable",
    "/jc:configuration/protocols/isis/level/name",
    "/jc:configuration/protocols/isis/level/no-csnp-authentication",
    "/jc:configuration/protocols/isis/level/no-hello-authentication",
    "/jc:configuration/protocols/isis/level/no-psnp-authentication",
    "/jc:configuration/protocols/isis/level/wide-metrics-only",
    "/jc:configuration/protocols/isis/lsp-lifetime",
    "/jc:configuration/protocols/ldp/interface/disable",
    "/jc:configuration/protocols/ldp/interface/hello-interval",
    "/jc:configuration/protocols/ldp/interface/hold-time",
    "/jc:configuration/protocols/ldp/interface/name",
    "/jc:configuration/protocols/ldp/interface/transport-address",
    "/jc:configuration/protocols/ldp/preference",
    "/jc:configuration/protocols/ldp/transport-address",
    "/jc:configuration/protocols/mpls/interface/disable",
    "/jc:configuration/protocols/mpls/interface/name",
    "/jc:configuration/protocols/mpls/no-propagate-ttl",
    "/jc:configuration/rcsid",
    "/jc:configuration/routing-instances/instance/instance-type",
    "/jc:configuration/routing-instances/instance/interface/any",
    "/jc:configuration/routing-instances/instance/interface/multicast",
    "/jc:configuration/routing-instances/instance/interface/name",
    "/jc:configuration/routing-instances/instance/interface/primary",
    "/jc:configuration/routing-instances/instance/interface/unicast",
    "/jc:configuration/routing-instances/instance/name",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/export",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/import",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/name",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/as-override",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/authentication-algorithm",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/authentication-key",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/description",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/multihop",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/multihop/no-nexthop-change",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/multihop/ttl",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/name",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/neighbor/peer-as",
    "/jc:configuration/routing-instances/instance/protocols/bgp/group/passive",
    "/jc:configuration/routing-instances/instance/route-distinguisher",
    "/jc:configuration/routing-instances/instance/vrf-table-label",
    "/jc:configuration/routing-instances/instance/vrf-target/auto",
    "/jc:configuration/routing-instances/instance/vrf-target/community",
    "/jc:configuration/routing-instances/instance/vrf-target/export",
    "/jc:configuration/routing-instances/instance/vrf-target/import",
    "/jc:configuration/routing-options/autonomous-system/as-number",
    "/jc:configuration/system/host-name",
    "/jc:configuration/system/services",
    "/jc:configuration/system/services/netconf/rfc-compliant",
    "/jc:configuration/system/services/netconf/yang-compliant",
    "/jc:configuration/version",
]
        filter_schema(dt.root, paths)
        return dt

    def transform_filter_junos_switch(dt):
        paths = [
            "/jc:configuration/apply-groups",
            "/jc:configuration/jc-chassis:chassis/aggregated-devices/ethernet",
            "/jc:configuration/jc-chassis:chassis/aggregated-devices/ethernet/device-count",
            "/jc:configuration/jc-chassis:chassis/alarm/management-ethernet/link-down",
            "/jc:configuration/jc-chassis:chassis/fpc/name",
            "/jc:configuration/jc-chassis:chassis/fpc/pic/name",
            "/jc:configuration/jc-chassis:chassis/fpc/pic/port",
            "/jc:configuration/jc-chassis:chassis/fpc/pic/port/name",
            "/jc:configuration/jc-chassis:chassis/fpc/pic/port/number-of-sub-ports",
            "/jc:configuration/jc-chassis:chassis/fpc/pic/port/speed",
            "/jc:configuration/jc-chassis:chassis/redundancy",
            "/jc:configuration/jc-firewall:firewall/family/inet",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/name",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/destination-port",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/icmp-type",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/port",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/protocol",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/source-port",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/source-prefix-list",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/source-prefix-list/name",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/from/tcp-established",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/name",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/then/accept",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/then/count",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/then/discard",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/then/log",
            "/jc:configuration/jc-firewall:firewall/family/inet/filter/term/then/syslog",
            "/jc:configuration/jc-forwarding-options:forwarding-options/storm-control-profiles/all",
            "/jc:configuration/jc-forwarding-options:forwarding-options/storm-control-profiles/name",
            "/jc:configuration/jc-forwarding-options:forwarding-options/vxlan-disable-copy-tos-decap",
            "/jc:configuration/jc-forwarding-options:forwarding-options/vxlan-disable-copy-tos-encap",
            "/jc:configuration/jc-forwarding-options:forwarding-options/vxlan-routing/overlay-ecmp",
            "/jc:configuration/groups/jc-interfaces:interfaces/interface/name",
            "/jc:configuration/groups/jc-interfaces:interfaces/interface/unit",
            "/jc:configuration/groups/jc-interfaces:interfaces/interface/unit/family",
            "/jc:configuration/groups/jc-interfaces:interfaces/interface/unit/family/inet6",
            "/jc:configuration/groups/jc-interfaces:interfaces/interface/unit/family/inet6/nd6-stale-time",
            "/jc:configuration/groups/jc-interfaces:interfaces/interface/unit/name",
            "/jc:configuration/groups/name",
            "/jc:configuration/jc-interfaces:interfaces/interface/disable",
            "/jc:configuration/jc-interfaces:interfaces/interface/name",
            "/jc:configuration/jc-interfaces:interfaces/interface/number-of-sub-ports",
            "/jc:configuration/jc-interfaces:interfaces/interface/speed",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/description",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/disable",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family/inet",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family/inet/address",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family/inet/address/name",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family/inet/filter",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family/inet/filter/input",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/family/inet/filter/input/filter-name",
            "/jc:configuration/jc-interfaces:interfaces/interface/unit/name",
            "/jc:configuration/jc-policy-options:policy-options/as-list/members",
            "/jc:configuration/jc-policy-options:policy-options/as-list/name",
            "/jc:configuration/jc-policy-options:policy-options/community/members",
            "/jc:configuration/jc-policy-options:policy-options/community/name",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/name",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/community",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/evpn-mac-route",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/family",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/metric",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/nlri-route-type",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/protocol",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/route-filter/address",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/route-filter/choice-ident",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/from/route-filter/choice-value",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/name",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/then/accept",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/term/then/reject",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/then/load-balance",
            "/jc:configuration/jc-policy-options:policy-options/policy-statement/then/load-balance/per-packet",
            "/jc:configuration/jc-policy-options:policy-options/prefix-list/apply-path",
            "/jc:configuration/jc-policy-options:policy-options/prefix-list/name",
            "/jc:configuration/jc-policy-options:policy-options/prefix-list/prefix-list-item",
            "/jc:configuration/jc-policy-options:policy-options/prefix-list/prefix-list-item/name",
            "/jc:configuration/jc-protocols:protocols/bgp/group/authentication-key",
            "/jc:configuration/jc-protocols:protocols/bgp/group/bfd-liveness-detection",
            "/jc:configuration/jc-protocols:protocols/bgp/group/bfd-liveness-detection/minimum-interval",
            "/jc:configuration/jc-protocols:protocols/bgp/group/bfd-liveness-detection/multiplier",
            "/jc:configuration/jc-protocols:protocols/bgp/group/export",
            "/jc:configuration/jc-protocols:protocols/bgp/group/family",
            "/jc:configuration/jc-protocols:protocols/bgp/group/family/evpn",
            "/jc:configuration/jc-protocols:protocols/bgp/group/family/evpn/signaling",
            "/jc:configuration/jc-protocols:protocols/bgp/group/local-address",
            "/jc:configuration/jc-protocols:protocols/bgp/group/local-as",
            "/jc:configuration/jc-protocols:protocols/bgp/group/local-as/as-number",
            "/jc:configuration/jc-protocols:protocols/bgp/group/multipath",
            "/jc:configuration/jc-protocols:protocols/bgp/group/name",
            "/jc:configuration/jc-protocols:protocols/bgp/group/neighbor",
            "/jc:configuration/jc-protocols:protocols/bgp/group/neighbor/description",
            "/jc:configuration/jc-protocols:protocols/bgp/group/neighbor/name",
            "/jc:configuration/jc-protocols:protocols/bgp/group/preference",
            "/jc:configuration/jc-protocols:protocols/bgp/group/type",
            "/jc:configuration/jc-protocols:protocols/bgp/group/vpn-apply-export",
            "/jc:configuration/jc-protocols:protocols/evpn/default-gateway",
            "/jc:configuration/jc-protocols:protocols/evpn/encapsulation",
            "/jc:configuration/jc-protocols:protocols/evpn/multicast-mode",
            "/jc:configuration/jc-protocols:protocols/igmp-snooping/vlan/name",
            "/jc:configuration/jc-protocols:protocols/l2-learning/global-mac-table-aging-time",
            "/jc:configuration/jc-protocols:protocols/lldp/interface/disable",
            "/jc:configuration/jc-protocols:protocols/lldp/interface/name",
            "/jc:configuration/jc-protocols:protocols/lldp-med/interface/disable",
            "/jc:configuration/jc-protocols:protocols/lldp-med/interface/name",
            "/jc:configuration/jc-protocols:protocols/network-isolation/group/detection/service-tracking",
            "/jc:configuration/jc-protocols:protocols/network-isolation/group/detection/service-tracking/core-isolation",
            "/jc:configuration/jc-protocols:protocols/network-isolation/group/name",
            "/jc:configuration/jc-protocols:protocols/network-isolation/group/service-tracking-action/link-down",
            "/jc:configuration/jc-protocols:protocols/ospf/area/interface",
            "/jc:configuration/jc-protocols:protocols/ospf/area/interface/name",
            "/jc:configuration/jc-protocols:protocols/ospf/area/interface/passive",
            "/jc:configuration/jc-protocols:protocols/ospf/area/name",
            "/jc:configuration/jc-protocols:protocols/ospf/export",
            "/jc:configuration/jc-protocols:protocols/ospf/external-preference",
            "/jc:configuration/jc-protocols:protocols/ospf/overload/timeout",
            "/jc:configuration/jc-protocols:protocols/ospf/preference",
            "/jc:configuration/jc-protocols:protocols/ospf/reference-bandwidth",
            "/jc:configuration/jc-protocols:protocols/ospf/spf-options/rapid-runs",
            "/jc:configuration/jc-routing-instances:routing-instances/instance/description",
            "/jc:configuration/jc-routing-instances:routing-instances/instance/name",
            "/jc:configuration/jc-routing-instances:routing-instances/instance/routing-options/static/route/name",
            "/jc:configuration/jc-routing-instances:routing-instances/instance/routing-options/static/route/next-hop",
            "/jc:configuration/jc-routing-instances:routing-instances/instance/routing-options/static/route/no-readvertise",
            "/jc:configuration/jc-routing-instances:routing-instances/instance/routing-options/static/route/retain",
            "/jc:configuration/jc-routing-options:routing-options/autonomous-system/as-number",
            "/jc:configuration/jc-routing-options:routing-options/forwarding-table/chained-composite-next-hop/ingress",
            "/jc:configuration/jc-routing-options:routing-options/forwarding-table/chained-composite-next-hop/ingress/evpn",
            "/jc:configuration/jc-routing-options:routing-options/forwarding-table/ecmp-fast-reroute",
            "/jc:configuration/jc-routing-options:routing-options/forwarding-table/export",
            "/jc:configuration/jc-routing-options:routing-options/ppm/inline-processing-enable",
            "/jc:configuration/jc-routing-options:routing-options/router-id",
            "/jc:configuration/jc-routing-options:routing-options/static/route/name",
            "/jc:configuration/jc-routing-options:routing-options/static/route/next-hop",
            "/jc:configuration/jc-routing-options:routing-options/static/route/no-readvertise",
            "/jc:configuration/jc-routing-options:routing-options/static/route/retain",
            "/jc:configuration/jc-snmp:snmp/community/authorization",
            "/jc:configuration/jc-snmp:snmp/community/client-list-name",
            "/jc:configuration/jc-snmp:snmp/community/name",
            "/jc:configuration/jc-snmp:snmp/community/routing-instance/name",
            "/jc:configuration/jc-snmp:snmp/community/view",
            "/jc:configuration/jc-snmp:snmp/contact",
            "/jc:configuration/jc-snmp:snmp/description",
            "/jc:configuration/jc-snmp:snmp/engine-id",
            "/jc:configuration/jc-snmp:snmp/engine-id/local",
            "/jc:configuration/jc-snmp:snmp/filter-duplicates",
            "/jc:configuration/jc-snmp:snmp/location",
            "/jc:configuration/jc-snmp:snmp/routing-instance-access",
            "/jc:configuration/jc-snmp:snmp/system-name",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/authentication",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/chassis",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/configuration",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/link",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/remote-operations",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/rmon-alarm",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/routing",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/services",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/startup",
            "/jc:configuration/jc-snmp:snmp/trap-group/categories/vrrp-events",
            "/jc:configuration/jc-snmp:snmp/trap-group/destination-port",
            "/jc:configuration/jc-snmp:snmp/trap-group/name",
            "/jc:configuration/jc-snmp:snmp/trap-group/routing-instance",
            "/jc:configuration/jc-snmp:snmp/trap-group/targets",
            "/jc:configuration/jc-snmp:snmp/trap-group/targets/name",
            "/jc:configuration/jc-snmp:snmp/trap-group/version",
            "/jc:configuration/jc-snmp:snmp/trap-options/source-address",
            "/jc:configuration/jc-snmp:snmp/trap-options/source-address/address",
            "/jc:configuration/jc-snmp:snmp/v3/management-routing-instance",
            "/jc:configuration/jc-snmp:snmp/v3/usm/local-engine/user/authentication-sha",
            "/jc:configuration/jc-snmp:snmp/v3/usm/local-engine/user/authentication-sha/authentication-key",
            "/jc:configuration/jc-snmp:snmp/v3/usm/local-engine/user/name",
            "/jc:configuration/jc-snmp:snmp/v3/usm/local-engine/user/privacy-aes128",
            "/jc:configuration/jc-snmp:snmp/v3/usm/local-engine/user/privacy-aes128/privacy-key",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/access/group/default-context-prefix/security-model/name",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/access/group/default-context-prefix/security-model/security-level",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/access/group/default-context-prefix/security-model/security-level/name",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/access/group/default-context-prefix/security-model/security-level/read-view",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/access/group/name",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/security-to-group/security-model/name",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/security-to-group/security-model/security-name/group",
            "/jc:configuration/jc-snmp:snmp/v3/vacm/security-to-group/security-model/security-name/name",
            "/jc:configuration/jc-snmp:snmp/view/name",
            "/jc:configuration/jc-snmp:snmp/view/oid/include",
            "/jc:configuration/jc-snmp:snmp/view/oid/name",
            "/jc:configuration/jc-switch-options:switch-options/route-distinguisher/rd-type",
            "/jc:configuration/jc-switch-options:switch-options/vrf-import",
            "/jc:configuration/jc-switch-options:switch-options/vrf-target/community",
            "/jc:configuration/jc-switch-options:switch-options/vtep-source-interface/interface-name",
            "/jc:configuration/jc-system:system/accounting/destination/tacplus",
            "/jc:configuration/jc-system:system/accounting/events",
            "/jc:configuration/jc-system:system/arp/aging-timer",
            "/jc:configuration/jc-system:system/authentication-order",
            "/jc:configuration/jc-system:system/compress-configuration-files",
            "/jc:configuration/jc-system:system/domain-name",
            "/jc:configuration/jc-system:system/host-name",
            "/jc:configuration/jc-system:system/internet-options/no-source-quench",
            "/jc:configuration/jc-system:system/internet-options/no-tcp-reset",
            "/jc:configuration/jc-system:system/internet-options/path-mtu-discovery",
            "/jc:configuration/jc-system:system/internet-options/tcp-drop-synfin-set",
            "/jc:configuration/jc-system:system/internet-options/undocumented",
            "/jc:configuration/jc-system:system/internet-options/undocumented/tcp-reset-syn-acknowledge",
            "/jc:configuration/jc-system:system/license/keys/key/name",
            "/jc:configuration/jc-system:system/login/class/allow-commands",
            "/jc:configuration/jc-system:system/login/class/deny-commands",
            "/jc:configuration/jc-system:system/login/class/idle-timeout",
            "/jc:configuration/jc-system:system/login/class/name",
            "/jc:configuration/jc-system:system/login/class/permissions",
            "/jc:configuration/jc-system:system/login/message",
            "/jc:configuration/jc-system:system/login/user/class",
            "/jc:configuration/jc-system:system/login/user/full-name",
            "/jc:configuration/jc-system:system/login/user/name",
            "/jc:configuration/jc-system:system/login/user/uid",
            "/jc:configuration/jc-system:system/management-instance",
            "/jc:configuration/jc-system:system/no-ping-record-route",
            "/jc:configuration/jc-system:system/no-ping-time-stamp",
            "/jc:configuration/jc-system:system/no-redirects",
            "/jc:configuration/jc-system:system/no-redirects-ipv6",
            "/jc:configuration/jc-system:system/ntp/server/name",
            "/jc:configuration/jc-system:system/ntp/server/routing-instance",
            "/jc:configuration/jc-system:system/ntp/source-address/name",
            "/jc:configuration/jc-system:system/ntp/source-address/routing-instance",
            "/jc:configuration/jc-system:system/ports/console/log-out-on-disconnect",
            "/jc:configuration/jc-system:system/services/netconf/ssh",
            "/jc:configuration/jc-system:system/services/ssh/client-alive-count-max",
            "/jc:configuration/jc-system:system/services/ssh/client-alive-interval",
            "/jc:configuration/jc-system:system/services/ssh/connection-limit",
            "/jc:configuration/jc-system:system/services/ssh/max-sessions-per-connection",
            "/jc:configuration/jc-system:system/services/ssh/no-tcp-forwarding",
            "/jc:configuration/jc-system:system/services/ssh/protocol-version",
            "/jc:configuration/jc-system:system/services/ssh/rate-limit",
            "/jc:configuration/jc-system:system/services/ssh/root-login",
            "/jc:configuration/jc-system:system/syslog/archive/files",
            "/jc:configuration/jc-system:system/syslog/archive/size",
            "/jc:configuration/jc-system:system/syslog/archive/world-readable",
            "/jc:configuration/jc-system:system/syslog/file/contents",
            "/jc:configuration/jc-system:system/syslog/file/contents/any",
            "/jc:configuration/jc-system:system/syslog/file/contents/info",
            "/jc:configuration/jc-system:system/syslog/file/contents/name",
            "/jc:configuration/jc-system:system/syslog/file/contents/notice",
            "/jc:configuration/jc-system:system/syslog/file/explicit-priority",
            "/jc:configuration/jc-system:system/syslog/file/name",
            "/jc:configuration/jc-system:system/syslog/host/contents/info",
            "/jc:configuration/jc-system:system/syslog/host/contents/name",
            "/jc:configuration/jc-system:system/syslog/host/explicit-priority",
            "/jc:configuration/jc-system:system/syslog/host/name",
            "/jc:configuration/jc-system:system/syslog/host/source-address",
            "/jc:configuration/jc-system:system/syslog/routing-instance",
            "/jc:configuration/jc-system:system/syslog/time-format/millisecond",
            "/jc:configuration/jc-system:system/syslog/user/contents/emergency",
            "/jc:configuration/jc-system:system/syslog/user/contents/name",
            "/jc:configuration/jc-system:system/syslog/user/name",
            "/jc:configuration/jc-system:system/tacplus-options/strict-authorization",
            "/jc:configuration/jc-system:system/time-zone",
    ]
        filter_schema(dt.root, paths)
        return dt

    # The paths referenced by these leafrefs are invalid - missing module
    # imports. We explicitly allow resolving the target leaf type to fallback to
    # a string so that we can avoid adding more models here ...
    broken_leafrefs = [
        "/network-instance/protocols/isis/instance/export-policy",
        "/network-instance/protocols/isis/instance/authentication/keychain",
        "/network-instance/protocols/isis/instance/interface/level/authentication/keychain",
        "/network-instance/protocols/isis/instance/interface/authentication/keychain",
        "/network-instance/protocols/isis/instance/level/authentication/keychain",
        "/network-instance/protocols/bgp/authentication/keychain",
        "/network-instance/protocols/bgp/rib-management/table/route-table-import",
        "/network-instance/protocols/bgp/group/authentication/keychain",
        "/network-instance/protocols/bgp/group/send-default-route/export-policy",
        "/network-instance/protocols/bgp/neighbor/authentication/keychain",
        "/network-instance/protocols/bgp/neighbor/send-default-route/export-policy",
    ]

    spec = orchestron.build.SysSpec("sorespo", [
        cfs_layer,
        inter_layer,
        rfs_layer,
    ], [
        orchestron.build.DeviceType.from_dir(fc, "CiscoIosXr_24_1_ncs55a1", "yang/CiscoIosXr_24_1_ncs55a1"),
        orchestron.build.DeviceType.from_dir(fc, "JuniperCRPD_23_4R1_9", "yang/JuniperCRPD_23_4R1_9"),
        orchestron.build.DeviceType.from_dir(fc, "JuniperSwitch_21_4", "yang/JuniperSwitch_21_4"),
        orchestron.build.DeviceType.from_dir(fc, "NokiaSRLinux_25_3_2", "yang/NokiaSRLinux_25_3_2"),
    ])
    compiled_spec = spec.compile(broken_leafrefs)
    transform_list_order(transform_filter(compiled_spec.dev_types["JuniperCRPD_23_4R1_9"]))
    transform_filter_junos_switch(compiled_spec.dev_types["JuniperSwitch_21_4"])
    compiled_spec.gen_app(fc, "../src/")

    env.exit(0)
